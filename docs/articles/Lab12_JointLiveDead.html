<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lab12: Joint Live-Dead Recovery Models • WILD8370</title>
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lab12: Joint Live-Dead Recovery Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WILD8370</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-house-chimney"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fab fa-readme"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa far fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-file-powerpoint"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_inference/01_inference.html">Lecture 1: Statistical inference in ecology</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_probability/02_probability.html">Lecture 2: Probability refresher</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_bayes/03_bayes.html">Lecture 3: Principles of Bayesian inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/04_intro_nimble/Intro_Nimble.html">Lecture 4: Introduction to Nimble</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/05_glms/05_glms.html">Lecture 5: Generalized linear model review</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_priors/06_priors.html">Lecture 6: More about priors</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/07_random_effects/07_random_effects.html">Lecture 7: Random vs. Fixed Effects</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/08_occupancy/08_occupancy.html">Lecture 8: State Space Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/09_NMix/09_NMix.html">Lecture 9: N-Mixture and Occupancy</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/11_DynamicNMix/11_DynamicNMix.html">Lecture 11: Dynamic N-Mixture Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/9b_ExtraOcc/9b_ExtraOcc.html">Lecture 9b: Static Occupancy Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/10_DynamicOcc/10_DynamicOcc.html">Lecture 10: Dynamic Occupancy Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/12_MovementModels/12_MovementModels.html">Lecture 12: Movement Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/13_ClosedCMR/Lecture13_ClosedCMR.html">Lecture 13: Closed CMR</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/14_ClosedSCR/Lecture14_ClosedSCR.html">Lecture 14: Closed SCR</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/15_KnownFate/15_KnownFate.html">Lecture 15: Known Fate Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/16_CJS/16_CJS.html">Lecture 16: CJS Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/17_MultiState/17_Multistate.html">Lecture 17: Multistate Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/18_CT/18_CT.html">Lecture 18: Continuous-time CMR</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/19_JS/19_openCMR.html">Lecture 19: Open Capture Mark Recapture Part 1</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/20_JSSuper/20_JSSuper.html">Lecture 20: Open Capture Mark Recapture Part 2</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/21_MultiOcc/21_MultiOcc.html">Lecture 21: Multispecies Occupancy</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/22_USCR/21_USCR.html">Lecture 22: Unmarked SCR</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-laptop-code"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 0: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/Lab01b_Mathematical_Notation.html">Lab 1: Mathematical Notation</a></li>
    <li><a class="dropdown-item" href="../articles/Lab2_simulation.html">Lab 2: Data Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/Lab3_BasicMCMC.html">Lab 3: Basic MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/Lab4_glms.html">Lab 4: GLMs</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Lab 5: Priors</a></li>
    <li><a class="dropdown-item" href="../articles/Lab6_MissingData.html">Lab 6: Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/Lab7_GOF.html">Lab 7: Goodness of Fit</a></li>
    <li><a class="dropdown-item" href="../articles/Lab8_Movement.html">Lab 8: Resource Selection Functions</a></li>
    <li><a class="dropdown-item" href="../articles/Lab9_SCR.html">Lab 9: Spatial Capture Recapture</a></li>
    <li><a class="dropdown-item" href="../articles/Lab10_CJS.html">Lab 10: CJS</a></li>
    <li><a class="dropdown-item" href="../articles/Lab11_Multistate.html">Lab 11: Continuous-time CMR</a></li>
    <li><a class="dropdown-item" href="../articles/Lab12_JointLiveDead.html">Lab 12: Joint Live-Dead Recovery Models</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-bookmark"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lab12: Joint Live-Dead Recovery Models</h1>
            
      

      <div class="d-none name"><code>Lab12_JointLiveDead.Rmd</code></div>
    </div>

    
    
<p>Today’s lab will focus on joint live-dead recovery models. These can
be written as a multi-state model or marginalized for faster analysis in
a hidden markov model framework.</p>
<div class="section level2">
<h2 id="joint-live-dead-recovery-models">Joint live-dead recovery models<a class="anchor" aria-label="anchor" href="#joint-live-dead-recovery-models"></a>
</h2>
<p>In the world of game-species, there is often a reward for hunters who
report any tags or bands they find on their harvested prey. Not every
animal that is tagged will be reported, either because hunters poach the
animal or because the animal dies from some other method besides
human-induced mortality. In the non-game world, these models are often
used in situations where dead animals are sometimes found incidentally
when surveying for live animals (such as finding a marked tortoise shell
while surveying gopher tortoises).</p>
<p>The following graphic from the phidot.org MARK handbook does a great
job of explaining the general idea.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"Fates.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Fates.png" width="75%" style="display: block; margin: auto;"></p>
<p>From this diagram, we can easily establish the likelihood of any
capture/encounter history (again, stealing this from the MARK handbook).
Below is the likelihood for a 2-occasion study.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="st">"Likelihoods.png"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Likelihoods.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="example---snow-goose-data">Example - Snow Goose Data<a class="anchor" aria-label="anchor" href="#example---snow-goose-data"></a>
</h2>
<p>Today’s data comes from an 18-year data set on the lesser snow goose
(<em>Anser caerulescens caerulescens</em>). 18,493 adult female geese
were captured from 1997 to 2014, during their flightless phase in
Nunavut, Canada. The citation for the paper containing this data can be
found here:</p>
<p>Weegman MD, Wilson S, Alisauskas RT, Kellett DK. Assessing bias in
demographic estimates from joint live and dead encounter models. PeerJ.
2020 Jun 23;8:e9382. doi: 10.7717/peerj.9382. PMID: 32612891; PMCID:
PMC7319022.</p>
<p>The geese could be observed in 1 of 3 states:</p>
<p>1 = alive in the study area</p>
<p>2 = recovered dead</p>
<p>3 = not seen</p>
<p>For the sake of this lab, we will only be using a subset of the data
from the first 10 years.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://rushinglab.github.io/WILD8370">WILD8370</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span></span>
<span><span class="co">#&gt;    1 2 3 4 5 6 7 8 9 10</span></span>
<span><span class="co">#&gt; 57 1 3 3 3 3 3 3 3 3  3</span></span>
<span><span class="co">#&gt; 12 1 3 3 3 3 3 3 3 3  3</span></span>
<span><span class="co">#&gt; 70 1 3 3 3 3 3 3 3 3  3</span></span>
<span><span class="co">#&gt; 16 1 3 3 3 3 3 3 3 3  3</span></span>
<span><span class="co">#&gt; 17 1 3 3 3 3 3 3 3 3  3</span></span>
<span><span class="co">#&gt; 36 1 3 3 3 3 3 3 3 3  3</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model">Model<a class="anchor" aria-label="anchor" href="#model"></a>
</h2>
<p>We would like to code the model so that geese can be in 5 possible
true states:</p>
<p>1 = Pre-alive</p>
<p>2 = alive in the study area</p>
<p>3 = alive and <strong>permanently</strong> emigrated</p>
<p>4 = recently dead <strong>and</strong> recovered (notice this state
inherently includes detection of the death)</p>
<p>5 = recently dead, but not recovered, or dead for more than 1 time
period (absorbing)</p>
<p>We will treat <span class="math inline">\phi</span>, <span class="math inline">p</span>, and <span class="math inline">gam</span>
as time-varying. <span class="math inline">\phi</span> and <span class="math inline">p</span>,will be modeled as logit-link with an
intercept and a random effect of year.</p>
<div class="section level3">
<h3 id="transition-matrix">Transition Matrix<a class="anchor" aria-label="anchor" href="#transition-matrix"></a>
</h3>
<p>We will build the model in sections, starting with the transition
matrix.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nocc){</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  gamma[<span class="dv">1</span>,<span class="dv">1</span>,t] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>gam[t]            <span class="co"># Pr(pre alive t -&gt; pre alive t+1)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  gamma[<span class="dv">1</span>,<span class="dv">2</span>,t] <span class="ot">&lt;-</span> gam[t]              <span class="co"># Pr(pre alive t -&gt; alive and here t+1)</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  gamma[<span class="dv">1</span>,<span class="dv">3</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(pre alive t -&gt; alive but gone t+1)</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  gamma[<span class="dv">1</span>,<span class="dv">4</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(pre alive t -&gt; recent dead and recovered t+1)</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  gamma[<span class="dv">1</span>,<span class="dv">5</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(pre alive t -&gt; absorbing dead t+1)</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  gamma[<span class="dv">2</span>,<span class="dv">1</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(alive t -&gt; pre-alive t+1)</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  gamma[<span class="dv">2</span>,<span class="dv">2</span>,t] <span class="ot">&lt;-</span> phi[t]<span class="sc">*</span>f            <span class="co"># Pr(alive t -&gt; alive and here t+1)</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  gamma[<span class="dv">2</span>,<span class="dv">3</span>,t] <span class="ot">&lt;-</span> phi[t]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>f)        <span class="co"># Pr(alive t -&gt; alive but gone t+1)</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  gamma[<span class="dv">2</span>,<span class="dv">4</span>,t] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>phi[t])<span class="sc">*</span>r        <span class="co"># Pr(alive t -&gt; recent dead and recovered t+1)</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  gamma[<span class="dv">2</span>,<span class="dv">5</span>,t] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>phi[t])<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>r)    <span class="co"># Pr(alive t -&gt; absorbing dead t+1)</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  gamma[<span class="dv">3</span>,<span class="dv">1</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(alive but gone t -&gt; pre-alive t+1)</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  gamma[<span class="dv">3</span>,<span class="dv">2</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(alive but gone t -&gt; alive and here t+1)</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  gamma[<span class="dv">3</span>,<span class="dv">3</span>,t] <span class="ot">&lt;-</span> phi[t]              <span class="co"># Pr(alive but gone t -&gt; alive but gone t+1)</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  gamma[<span class="dv">3</span>,<span class="dv">4</span>,t] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>phi[t])<span class="sc">*</span>r        <span class="co"># Pr(alive but gone t -&gt; recent dead and recovered t+1)</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  gamma[<span class="dv">3</span>,<span class="dv">5</span>,t] <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>phi[t])<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>r)    <span class="co"># Pr(alive but gone t -&gt; absorbing dead t+1)</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  </span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  gamma[<span class="dv">4</span>,<span class="dv">1</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(Recently dead t -&gt; pre-alive t+1)</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>  gamma[<span class="dv">4</span>,<span class="dv">2</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(Recently dead t -&gt; alive and here t+1)</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>  gamma[<span class="dv">4</span>,<span class="dv">3</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(Recently dead t -&gt; alive but gone t+1)</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>  gamma[<span class="dv">4</span>,<span class="dv">4</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(Recently dead t -&gt; recent dead and recovered t+1)</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  gamma[<span class="dv">4</span>,<span class="dv">5</span>,t] <span class="ot">&lt;-</span> <span class="dv">1</span>                   <span class="co"># Pr(Recently dead t -&gt; absorbing dead t+1)</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>  </span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>  gamma[<span class="dv">5</span>,<span class="dv">1</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; pre-alive t+1)</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>  gamma[<span class="dv">5</span>,<span class="dv">2</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; alive and here t+1)</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  gamma[<span class="dv">5</span>,<span class="dv">3</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; alive but gone t+1)</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>  gamma[<span class="dv">5</span>,<span class="dv">4</span>,t] <span class="ot">&lt;-</span> <span class="dv">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; recent dead and recovered t+1)</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  gamma[<span class="dv">5</span>,<span class="dv">5</span>,t] <span class="ot">&lt;-</span> <span class="dv">1</span>                   <span class="co"># Pr(absorbing dead t -&gt; absorbing dead t+1)</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="observation-matrix">Observation Matrix<a class="anchor" aria-label="anchor" href="#observation-matrix"></a>
</h3>
<p>Next let’s make the observation matrix. This is a 5 X 3 matrix since
we can only observe geese in 3 possible states (alive, dead, not
observed).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(pre alive t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>        <span class="co"># Pr(alive and here t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(alive and gone t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(recent dead and recovered t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(absorbing dead t and detected as alive)</span></span>
<span>  </span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(pre alive t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(alive and here t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(alive and gone t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>           <span class="co"># Pr(recent dead and recovered t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(absorbing dead t and recovered dead)</span></span>
<span>  </span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>           <span class="co"># Pr(pre alive t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>      <span class="co"># Pr(alive and here t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>           <span class="co"># Pr(alive and gone t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>           <span class="co"># Pr(recent dead and recovered t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>           <span class="co"># Pr(absorbing dead t and not observed)</span></span>
<span>  </span>
<span>  </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="initial-matrix-and-priors">Initial Matrix and Priors<a class="anchor" aria-label="anchor" href="#initial-matrix-and-priors"></a>
</h3>
<p>Let’s get the initial probability of each state and then add in our
priors. Rather than writing out a dbeta prior for each delta, I’m just
going to use a dirichlet prior, which will ensure all the resulting
probabilities sum to 1. The dirichlet can be thought of as a multinomial
but for probabilities.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">delta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu">ddirch</span><span class="op">(</span><span class="va">alphas</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">logit</span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mu.p</span> <span class="op">+</span> <span class="va">eps.p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="co">#detection</span></span>
<span>  <span class="fu">logit</span><span class="op">(</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mu.phi</span> <span class="op">+</span> <span class="va">eps.phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="co">#survival</span></span>
<span>  <span class="va">eps.p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd.p</span><span class="op">)</span></span>
<span>  <span class="va">eps.phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd.phi</span><span class="op">)</span></span>
<span>  <span class="va">gam</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#removal from augmented population</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="co">#recovery probability</span></span>
<span><span class="va">f</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="co">#fidelity probability</span></span>
<span><span class="va">sd.phi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sd.p</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="full-model">Full Model<a class="anchor" aria-label="anchor" href="#full-model"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">livedeadHMM</span> <span class="op">&lt;-</span> <span class="fu">nimbleCode</span><span class="op">(</span><span class="op">{</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nocc</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">gam</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>            <span class="co"># Pr(pre alive t -&gt; pre alive t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gam</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>              <span class="co"># Pr(pre alive t -&gt; alive and here t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(pre alive t -&gt; alive but gone t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(pre alive t -&gt; recent dead and recovered t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(pre alive t -&gt; absorbing dead t+1)</span></span>
<span>  </span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive t -&gt; pre-alive t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">*</span><span class="va">f</span>            <span class="co"># Pr(alive t -&gt; alive and here t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">f</span><span class="op">)</span>        <span class="co"># Pr(alive t -&gt; alive but gone t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">r</span>        <span class="co"># Pr(alive t -&gt; recent dead and recovered t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">5</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r</span><span class="op">)</span>    <span class="co"># Pr(alive t -&gt; absorbing dead t+1)</span></span>
<span>  </span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive but gone t -&gt; pre-alive t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive but gone t -&gt; alive and here t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>              <span class="co"># Pr(alive but gone t -&gt; alive but gone t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">r</span>        <span class="co"># Pr(alive but gone t -&gt; recent dead and recovered t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">r</span><span class="op">)</span>    <span class="co"># Pr(alive but gone t -&gt; absorbing dead t+1)</span></span>
<span>  </span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(Recently dead t -&gt; pre-alive t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(Recently dead t -&gt; alive and here t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(Recently dead t -&gt; alive but gone t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(Recently dead t -&gt; recent dead and recovered t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(Recently dead t -&gt; absorbing dead t+1)</span></span>
<span>  </span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; pre-alive t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; alive and here t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; alive but gone t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t -&gt; recent dead and recovered t+1)</span></span>
<span>  <span class="va">gamma</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(absorbing dead t -&gt; absorbing dead t+1)</span></span>
<span>  </span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(pre alive t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>                <span class="co"># Pr(alive and here t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive and gone t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(recent dead and recovered t and detected as alive)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t and detected as alive)</span></span>
<span>  </span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(pre alive t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive and here t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(alive and gone t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(recent dead and recovered t and recovered dead)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(absorbing dead t and recovered dead)</span></span>
<span>  </span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(pre alive t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span>              <span class="co"># Pr(alive and here t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(alive and gone t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                   <span class="co"># Pr(recent dead and recovered t and not observed)</span></span>
<span>  <span class="va">omega</span><span class="op">[</span><span class="fl">5</span>,<span class="fl">3</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>                   <span class="co"># Pr(absorbing dead t and not observed)</span></span>
<span></span>
<span>  <span class="fu">logit</span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mu.p</span> <span class="op">+</span> <span class="va">eps.p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="co">#detection</span></span>
<span>  <span class="fu">logit</span><span class="op">(</span><span class="va">phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mu.phi</span> <span class="op">+</span> <span class="va">eps.phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="co">#survival</span></span>
<span>  <span class="va">eps.p</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd.p</span><span class="op">)</span></span>
<span>  <span class="va">eps.phi</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, sd <span class="op">=</span> <span class="va">sd.phi</span><span class="op">)</span></span>
<span>  <span class="va">gam</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="co">#removal from augmented population</span></span>
<span><span class="op">}</span> <span class="co">#end t</span></span>
<span></span>
<span><span class="va">delta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="op">~</span> <span class="fu">ddirch</span><span class="op">(</span><span class="va">alphas</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="co">#recovery probability</span></span>
<span><span class="va">f</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">dbeta</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="co">#fidelity probability</span></span>
<span><span class="va">sd.phi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sd.p</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mu.p</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mu.phi</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nocc</span><span class="op">]</span> <span class="op">~</span> <span class="fu">dDHMMo</span><span class="op">(</span>init <span class="op">=</span>  <span class="va">delta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>                         probObs <span class="op">=</span> <span class="va">omega</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="va">nocc</span><span class="op">]</span>,</span>
<span>                         probTrans <span class="op">=</span> <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nocc</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                         len <span class="op">=</span> <span class="va">nocc</span>,</span>
<span>                         checkRowSums <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="co">#end M</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>Time to make some nimble objects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span></span>
<span><span class="va">nocc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span></span>
<span><span class="va">nind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">snowgeese</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="va">nind</span>, <span class="va">nocc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>, nocc <span class="op">=</span> <span class="va">nocc</span>, alphas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ni</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eps.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nocc</span><span class="op">)</span>,</span>
<span>           eps.phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nocc</span><span class="op">)</span>,</span>
<span>           sd.phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>           sd.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>           mu.p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>           mu.phi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>           r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>           f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>           gam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">nocc</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>           delta <span class="op">=</span> <span class="fu">rdirch</span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'mu.p'</span>, <span class="st">'eps.p'</span>, <span class="st">'sd.p'</span>, <span class="st">'mu.phi'</span>, <span class="st">'eps.phi'</span>, <span class="st">'sd.phi'</span>, <span class="st">'gam'</span>,  <span class="st">'delta'</span>, <span class="st">'r'</span>, <span class="st">'f'</span>, <span class="st">'phi'</span>, <span class="st">'p'</span><span class="op">)</span></span></code></pre></div>
<p>Check that the model is correctly setup.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nimble-dev/nimbleEcology" class="external-link">nimbleEcology</a></span><span class="op">)</span></span>
<span><span class="va">prepnim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleModel.html" class="external-link">nimbleModel</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">livedeadHMM</span>, constants <span class="op">=</span> <span class="va">nc</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">nd</span>, inits <span class="op">=</span> <span class="va">ni</span>, calculate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">prepnim</span><span class="op">$</span><span class="fu">initializeInfo</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">prepnim</span><span class="op">$</span><span class="fu">calculate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -4286</span></span></code></pre></div>
<p>This step may take several minutes (it’s a big model!)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="co">#each chain will be run separately </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="va">cl</span>, varlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ni"</span>,  <span class="st">"nc"</span>, <span class="st">'nd'</span>, <span class="st">"livedeadHMM"</span>, <span class="st">'params'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">geese</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterEvalQ</a></span><span class="op">(</span>cl <span class="op">=</span> <span class="va">cl</span>,<span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-nimble.org" class="external-link">nimble</a></span><span class="op">)</span> <span class="co">#reload packages for each core</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nimble-dev/nimbleEcology" class="external-link">nimbleEcology</a></span><span class="op">)</span></span>
<span><span class="va">prepnim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleModel.html" class="external-link">nimbleModel</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">livedeadHMM</span>, constants <span class="op">=</span> <span class="va">nc</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">nd</span>, inits <span class="op">=</span> <span class="va">ni</span>, calculate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">prepnim</span><span class="op">$</span><span class="fu">initializeInfo</span><span class="op">(</span><span class="op">)</span> <span class="co">#will tell you what is or isn't initialized</span></span>
<span><span class="va">prepnim</span><span class="op">$</span><span class="fu">calculate</span><span class="op">(</span><span class="op">)</span> <span class="co">#if this is NA or -Inf you know it's gone wrong</span></span>
<span><span class="va">mcmcnim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/configureMCMC.html" class="external-link">configureMCMC</a></span><span class="op">(</span><span class="va">prepnim</span>, monitors <span class="op">=</span> <span class="va">params</span>, print <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">nimMCMC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/buildMCMC.html" class="external-link">buildMCMC</a></span><span class="op">(</span><span class="va">mcmcnim</span><span class="op">)</span> <span class="co">#actually build the code for those samplers</span></span>
<span><span class="va">Cmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/compileNimble.html" class="external-link">compileNimble</a></span><span class="op">(</span><span class="va">prepnim</span><span class="op">)</span> <span class="co">#compiling the model itself in C++;</span></span>
<span><span class="va">Compnim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/compileNimble.html" class="external-link">compileNimble</a></span><span class="op">(</span><span class="va">nimMCMC</span>, project <span class="op">=</span> <span class="va">prepnim</span><span class="op">)</span> <span class="co"># compile the samplers next</span></span>
<span><span class="va">Compnim</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>niter <span class="op">=</span> <span class="fl">5000</span>, nburnin <span class="op">=</span> <span class="fl">1000</span>, thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">Compnim</span><span class="op">$</span><span class="va">mvSamples</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="co">#this will take awhile and not produce any progress bar</span></span>
<span><span class="va">geese</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">as.mcmc.list</a></span><span class="op">(</span><span class="va">geese</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>Time to inspect the chains</p>
<p>(You would inspect all of them in a a real analysis)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MCMCvis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCvis/man/MCMCtrace.html" class="external-link">MCMCtrace</a></span><span class="op">(</span><span class="va">geese</span>, params <span class="op">=</span> <span class="st">'delta'</span>,  pdf <span class="op">=</span> <span class="cn">F</span>, Rhat <span class="op">=</span> <span class="cn">T</span>, n.eff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab12_JointLiveDead_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"><img src="Lab12_JointLiveDead_files/figure-html/unnamed-chunk-14-2.png" width="768" style="display: block; margin: auto;"></p>
<p>Let’s check the population estimate over time. Remember that:</p>
<p><span class="math inline">\Large   N_t =
\frac{N_{observed}}{p_t}</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu">MCMCsummary</span><span class="op">(</span><span class="va">geese</span>, params <span class="op">=</span> <span class="st">'p'</span><span class="op">)</span></span>
<span><span class="va">seenalive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">snowgeese</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">LCI</span> <span class="op">&lt;-</span> <span class="va">seenalive</span><span class="op">/</span><span class="va">ps</span><span class="op">$</span><span class="va">`2.5%`</span></span>
<span><span class="va">UCI</span> <span class="op">&lt;-</span> <span class="va">seenalive</span><span class="op">/</span><span class="va">ps</span><span class="op">$</span><span class="va">`97.5%`</span></span>
<span><span class="va">Median</span> <span class="op">&lt;-</span> <span class="va">seenalive</span><span class="op">/</span><span class="va">ps</span><span class="op">$</span><span class="va">`50%`</span></span>
<span></span>
<span><span class="va">gg_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Median <span class="op">=</span> <span class="va">Median</span>,</span>
<span>                    LCI <span class="op">=</span> <span class="va">LCI</span>,</span>
<span>                    UCI <span class="op">=</span> <span class="va">UCI</span>,</span>
<span>                    Time <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nocc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gg_ab</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y<span class="op">=</span> <span class="va">Median</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LCI</span>,ymax <span class="op">=</span> <span class="va">UCI</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text<span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Abundance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab12_JointLiveDead_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can also evaluate how p and <span class="math inline">\phi</span>
changed over time:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phis</span> <span class="op">&lt;-</span> <span class="fu">MCMCsummary</span><span class="op">(</span><span class="va">geese</span>, params <span class="op">=</span> <span class="st">'phi'</span><span class="op">)</span></span>
<span><span class="va">gg_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">`50%`</span>, <span class="va">phis</span><span class="op">$</span><span class="va">`50%`</span><span class="op">)</span>,</span>
<span>                    LCI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">`2.5%`</span>, <span class="va">phis</span><span class="op">$</span><span class="va">`2.5%`</span><span class="op">)</span>,</span>
<span>                    UCI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ps</span><span class="op">$</span><span class="va">`97.5%`</span>, <span class="va">phis</span><span class="op">$</span><span class="va">`97.5%`</span><span class="op">)</span>,</span>
<span>                    Time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nocc</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                    Estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Detection probability'</span>, <span class="st">'Survival'</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">nocc</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">gg_ps</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y<span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="va">Estimate</span>, group <span class="op">=</span> <span class="va">Estimate</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LCI</span>,ymax <span class="op">=</span> <span class="va">UCI</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">position_dodge</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text<span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab12_JointLiveDead_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Finally, we can learn about fidelity and recovery probabilities.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MCMCvis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCvis/man/MCMCsummary.html" class="external-link">MCMCsummary</a></span><span class="op">(</span><span class="va">geese</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'f'</span>, <span class="st">'r'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      mean      sd   2.5%     50%  97.5% Rhat n.eff</span></span>
<span><span class="co">#&gt; f 0.17550 0.04312 0.1066 0.16989 0.2755 1.00   518</span></span>
<span><span class="co">#&gt; r 0.05657 0.02750 0.0260 0.04936 0.1301 1.02   290</span></span></code></pre></div>
<p>You’ll notice that many of these estimates have wide CIs - these
models are very data hungry!</p>
</div>
<div class="section level2">
<h2 id="homework">Homework<a class="anchor" aria-label="anchor" href="#homework"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Using the data from the joint live-dead recovery model we ran
above, run a hidden markov model that does <em>not</em> allow for dead
recovery. In the data, if animals are recovered dead, treat them as
unobserved in that time period. Graphically compare your estimates of
<span class="math inline">\phi</span> and <span class="math inline">N</span> with those estimated in the lab above. How
does including the dead recoveries impact your results?</p></li>
<li><p>Using the dipper data we used in class, run a hidden markov model
that accounts for location of capture in the state process. Instead of
the 3 states we had in class (pre-alive, alive, dead), you should now
have 5 states (pre-alive, alive at site 1, alive at site 2, alive at
site 3, and dead). You should have 4 observation states (seen at site 1,
seen at site 2, seen at site 3, and not seen). Keep phi constant between
sites, but allow p to vary by site. Make a graph showing the estimated
population at each site over time.</p></li>
<li><p>On a 1-10 scale, with 1 being the worst week ever and 10 being
the best, how would you rate this week’s content? What lingering
questions/confusion about the lecture or lab do you still have?</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing, Heather Gaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
