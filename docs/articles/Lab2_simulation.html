<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulating linear regression data • WILD8370</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating linear regression data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WILD8370</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-house-chimney"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fab fa-readme"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa far fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-file-powerpoint"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_inference/01_inference.html">Lecture 1: Statistical inference in ecology</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_probability/02_probability.html">Lecture 2: Probability refresher</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_bayes/03_bayes.html">Lecture 3: Principles of Bayesian inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_priors/06_priors.html">Lecture 6: More about priorss</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-laptop-code"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 0: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/Lab01b_Mathematical_Notation.html">Lab 1: Mathematical Notation</a></li>
    <li><a class="dropdown-item" href="../articles/Lab2_simulation.html">Lab 2: Data Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Lab 5: Priors</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-bookmark"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulating linear regression data</h1>
            
      

      <div class="d-none name"><code>Lab2_simulation.Rmd</code></div>
    </div>

    
    
<p>In this activity, we simulate data to familiarize ourselves with the
parameters of a linear regression model.</p>
<p>Simulating data involves many of the same tasks involved in preparing
raw data for analysis. Many of the core principles of so called “data
wrangling” are embodied by the <a href="https://www.tidyverse.org/packages/" class="external-link"><code>tidyverse</code></a>, a
family of packages created to make tidying, manipulating, and
visualizing data and model output more intuitive and consistent.
Throughout this semester, we will focus on using several of the
<code>tidyverse</code> packages to create reproducible data wrangling
scripts.</p>
<p>Use of the tidyverse is somewhat <a href="http://varianceexplained.org/r/teach-tidyverse/" class="external-link">controversial</a>
and it is worth noting that everything we will do in this lab can be
done using base <code>R</code> or non-tidyverse packages. Nonetheless, I
find the tidyverse useful <em>because</em> it is opinionated. The
developers of the tidyverse have spent a great deal of time thinking
about how data should be stored, manipulated, and visualized and they
have created an entire ecosystem of functions built around these
principles. Using the tidyverse isn’t so much about the tools themselves
as it is about <strong>thinking about the structure and manipulation of
data</strong>. For better or worse, focusing on consistent application
of these principles is not something base <code>R</code> encourages.</p>
<hr>
<p><strong>Objectives</strong></p>
<ul>
<li><p>Simulate data with known values to verify sampler results using
reproducible code</p></li>
<li>
<p>Learn/review basic data manipulation tasks, including:</p>
<ul>
<li>Adding new variables</li>
<li>Saving data</li>
</ul>
</li>
<li>
<p><code>R</code> functions used in this exercise:</p>
<ul>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code></li>
</ul>
</li>
</ul>
<hr>
<div class="section level3">
<h3 id="what-is-data-simulation">What is data simulation<a class="anchor" aria-label="anchor" href="#what-is-data-simulation"></a>
</h3>
<p>Data simulation is a technique for generating random data from
stochastic processes with known parameters. Although not framed as “data
simulation”, we have already done this several times this semester. For
example,</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">3</span>, <span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p>is a simple data simulation to generate random samples from a normal
distribution with known mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\mu=3</annotation></semantics></math>)
and variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mo>=</mo><msup><mn>0.75</mn><mn>2</mn></msup><mo>=</mo><mn>0.5625</mn></mrow><annotation encoding="application/x-tex">\sigma^2=0.75^2 = 0.5625</annotation></semantics></math>).</p>
<p>In this exercise, we’ll learn about simulating data under more
slightly complex models that are similar to the ones you might use to
analyze your data. For example, imagine a simple single-season occupancy
model with the probability of occupancy
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ψ</mi><mo>=</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\psi=0.75</annotation></semantics></math>
and detection probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.4</mn></mrow><annotation encoding="application/x-tex">p=0.4</annotation></semantics></math>.
In other words<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;annotation encoding="application/x-tex"&gt;z_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
can either be 1 (site
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;annotation encoding="application/x-tex"&gt;i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
is occupied) or 0 (site
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;annotation encoding="application/x-tex"&gt;i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
is unoccupied) and
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;annotation encoding="application/x-tex"&gt;y_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
can be 1 (species detected at site
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;annotation encoding="application/x-tex"&gt;i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;)
or 0 (species not detected at site
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;annotation encoding="application/x-tex"&gt;i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;).
In the second equation, adding
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;annotation encoding="application/x-tex"&gt;z_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
ensures that if the site is unoccupied
(&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mrow&gt;&lt;annotation encoding="application/x-tex"&gt;z_i=0&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;)
than
&lt;math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"&gt;&lt;semantics&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;annotation encoding="application/x-tex"&gt;y_i&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;
has to be 0 also. We’ll learn more about this formulation of occupancy
models later in the semester&lt;/p&gt;'><sup>1</sup></a>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mi>i</mi></msub><mo>∼</mo><mi>B</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>o</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ψ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z_i \sim Bernoulli(\psi)</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mi>B</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>o</mi><mi>u</mi><mi>l</mi><mi>l</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mi>i</mi></msub><mo>×</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_i \sim Bernoulli(z_i \times p)</annotation></semantics></math></p>
<p>We can simulate a data set from this model using a few lines of
<code>R</code> code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nSites</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># Number of sites</span></span>
<span><span class="va">nVisits</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fl">0.75</span>    <span class="co"># Occupancy probability</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.4</span>       <span class="co"># Detection probability</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSites</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">psi</span><span class="op">)</span>     <span class="co">## Generate true state of each site;</span></span>
<span>                                                  <span class="co">## nb Bernoulli = binomial with size = 1</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSites</span><span class="op">*</span><span class="va">nVisits</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">z</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>   <span class="co">## Generate observations</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">y</span>, nrow <span class="op">=</span> <span class="va">nSites</span>, ncol <span class="op">=</span> <span class="va">nVisits</span><span class="op">)</span></span></code></pre></div>
<p>With those seven lines of code, we now how a fake data set that could
be fed into an occupancy model to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ψ</mi><annotation encoding="application/x-tex">\psi</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="why-simulate-data">Why simulate data?<a class="anchor" aria-label="anchor" href="#why-simulate-data"></a>
</h3>
<p>At first, it may seem strange to generate a fake data set just so we
can run it through a modeling exercise to get answers we already know.
But data simulation is a powerful technique in your toolbox as an
ecological modeler. There are a number of reasons data simulation is
useful<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Based on chapter 4 of Kery &amp;amp; Royle &lt;em&gt;Applied
Hierarchical Modeling in Ecology&lt;/em&gt;&lt;/p&gt;"><sup>2</sup></a>:</p>
<ol style="list-style-type: decimal">
<li><p><em>Truth is known</em>: Usually when we apply a model to data,
we don’t know the true parameter values that generated the data. In this
case, you may be able to fit the model but you’ll never know if it got
the right answer. With simulated data, you can check whether your model
returns the known parameter values. This is a useful way to make sure
you code is doing what you <em>think</em> it’s doing.</p></li>
<li><p><em>Sampling error</em>: As we already learned, sampling error is
an inherent part of any ecological analysis. The noise that results from
sampling error makes it harder to detect the true signals in our process
model. With real data, you only have a single data set, which makes it
hard to understand the effect of sampling error on your inference. With
simulated data, you can generate hundreds or even thousands of data sets
from the same process/observation models, allowing you to observe the
effects of sampling error directly.</p></li>
<li><p><em>Check characteristics of estimators</em>: Related to point 1,
with a complex model and just a single data set it’s difficult to
determine whether the estimators you are using are well-behaved; that
is, do they return estimates that are unbiased and precise. With
simulated data, you can directly quantify these properties.</p></li>
<li><p><em>Power analysis</em>: By varying the effect sizes and sample
sizes in your simulated data, you can easily perform power analyses.
Using simulated data in this way can be very useful for designing field
studies or helping to interpret inferences after data has been collected
and analyzed.</p></li>
<li><p><em>Check identifiability/estimability of parameters</em>: In
Bayesian models, we can always obtain posterior distributions for every
parameter in our model. However, these posteriors are not always useful.
In some cases, our data may provide little-to-no information about the
value of a parameter and therefore the posterior distribution for this
parameter will simply be determined by the prior. This lack of
<em>identifiability</em> may be caused by intrinsic properties of our
model (for example, if two parameters are completely confounded such
that different combinations of parameter values have the same
likelihood) or because our data do not provide enough information to
estimate all parameters in the model (for example, a regression model
with dozens of predictors but few observations). Although there are
rigorous methods for testing intrinsic identifiability, this task can be
extremely difficult for complex hierarchical models. Simulated data
allow you to check whether all parameters in your model can be estimated
by generating replicate data sets that have the same properties (sample
size, etc) as your data.</p></li>
<li><p><em>Check robustness to violations of model assumptions</em>: All
models have assumptions about how the data were generated. These
assumptions stem from the way we formulate the process and observation
models. Of course, most assumptions will be violated to some degree in
real data sets. With simulated data sets, we can generate data that we
know violate the assumptions of the model in one or more ways (e.g.,
generating heterogeneous survival probabilities for a model that assumes
constant survival). By comparing the parameters estimates from these
“mis-specified” data sets, we can gauge the degree to which our
inferences are sensitive to violations.</p></li>
<li><p><em>Better understand your model</em>: One good way to test
whether you really understand your model is to see if you can write the
code to simulate data under the model. In many cases, this exercise will
uncover misunderstandings or lack of understanding about what the model
is actually doing. Simulating data is a good way to make sure you
understand what each parameter in your model actually represents. If you
can simulate data from each part of the model, chances are you can also
figure out why your model may not be working the way you think it does.
In short, simulating data is a great way to develop a deeper
understanding of your model.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="simulating-linear-regression-data">Simulating linear regression data<a class="anchor" aria-label="anchor" href="#simulating-linear-regression-data"></a>
</h2>
<p>In this exercise, we will simulate and visualize data generated under
a very general process model: a linear regression. Because I’m probably
too guilty of being animal focused, we will assume the response variable
of the model are counts of the number of seeds produced by the flowers
of a rare, endangered orchid. As ecologists studying this orchid, we
want to know whether seed production is related to the number of visits
by the orchid’s specialist pollinator. Perhaps if it is, we can increase
the growth rate of the orchid population by boosting abundance of the
pollinator (assuming the number of visits is a function of pollinator
abundance).</p>
<p>So we hypothesize that seed number will increase linearly with
pollinator visitation. This hypothesis can then be translated into a
process model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo>*</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ϵ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i = \alpha + \beta * x_i + \epsilon_i</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>i</mi></msub><mo>∼</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_i \sim Normal(0, \sigma^2)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
is the number of seeds counted in flower
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
is the number of pollinator visits. For simplicity, we will assume that
we record both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
without error. In this model,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
are regression coefficients that govern the relationship between seed
counts and visitation and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\epsilon_i</annotation></semantics></math>
is a normally distribution error term. You may recognize this as a basic
linear regression model with a single covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>.</p>
<hr>
<p><strong>Choosing a probability distribution to describe seed
counts</strong></p>
<p>Earlier in the semester, we discussed the Poisson distribution as the
default distribution for data that have to be positive integers (e.g.,
count data). However, in this case, our choice of a linear regression
implies normally distributed data. Is this choice justified?</p>
<p>First of all, remember that a linear model is composed to two
parts:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>p</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>e</mi><mo>=</mo><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>c</mi><mspace width="0.278em"></mspace><mi>p</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>+</mo><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>h</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>c</mi><mspace width="0.278em"></mspace><mi>p</mi><mi>a</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">response = deterministic\; part+stochastic\; part</annotation></semantics></math></p>
<p>The distributional assumptions of a linear model refer to the
<em>residuals</em> (the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\epsilon_i</annotation></semantics></math>’s).
That is, we assume that there is stochastic error in the response
variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>)
and this error is equally likely to produce values that are larger or
smaller than the value predicted by the deterministic portion of the
model
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>+</mo><mi>β</mi><mo>*</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\alpha + \beta * x_i</annotation></semantics></math>).</p>
<p>For small counts, the Poisson distribution is asymmetrical, meaning
that we are more likely to generate values that are larger than the mean
than smaller than the mean. You can see this clearly in the histogram
below, which was generated from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>n</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mo>=</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Poisson(\lambda = 2)</annotation></semantics></math>:</p>
<p><img src="Lab2_simulation_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this case, assuming the error terms are normally distribution
would likely be inappropriate. However, as counts get larger, the
Poisson distribution starts to appear more “normal”:</p>
<p><img src="Lab2_simulation_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
<p>In this case,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mi>λ</mi><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">\mu = \lambda = 500</annotation></semantics></math>.
So as counts get bigger, there will be very little difference in the
results of a linear regression or a Poisson GLM.<br>
***</p>
</div>
<div class="section level2">
<h2 id="step-0-set-up-your-workspace-and-directories">Step 0: Set up your workspace and directories<a class="anchor" aria-label="anchor" href="#step-0-set-up-your-workspace-and-directories"></a>
</h2>
<p>Hopefully you have already created a main directory for this course
when you started the homework assignment on choosing priors. If you have
not already done so, create a sub-directory of that folder called
<code>data</code>.</p>
<p>For this exercise, create a new script and add it to whatever
sub-directory you will use to store analysis scripts (alternatively, you
could add this script to the <code>data</code> or <code>data-raw</code>
folders since we’ll use it to create data. Just use whatever system
makes most sense to you). In the next section, copy the code from the
markdown file into this script.</p>
</div>
<div class="section level2">
<h2 id="step-1-set-the-model-parameters">Step 1: Set the model parameters<a class="anchor" aria-label="anchor" href="#step-1-set-the-model-parameters"></a>
</h2>
<p>The first step to simulating data is to set the fixed values that are
needed to generate the stochastic data. This usually includes the sample
size, covariate and parameter values and any other fixed value relevant
to the analysis. In this case, we’ll first set the number of flowers
that we counted seeds from:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">175</span> <span class="co"># Number of flowers</span></span></code></pre></div>
<p>Next, we need to generate the covariate values, in this case
pollination visits. We’ll store these values in a data frame and assume
the number of visits ranges from 0 to 25:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>visits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="co"># Number of pollination visits</span></span></code></pre></div>
<p>A common task during data preparation is adding new variables that
are derived from variables in the raw data. In our example, we might
want to add a new variable with <em>scaled</em> values of the covariate.
In most analyses, it is good practice to scale covariate values so they
have a mean of 0 and do not extend too far above and below 0 (very large
values (positive or negative) can create numerical issues when fitting
models). So next we center and scale the visit covariate (we’ll do it
manually but it could also be done using the built-in function
<code><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale()</a></code> or by simply simulating data from a normal
distribution in the first place).</p>
<p>In the tidyverse, the workhorse of adding new variables in
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sim_df</span>, visits.c <span class="op">=</span> <span class="op">(</span><span class="va">visits</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">visits</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">visits</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>You can check that the covariate now has mean = 0 and sd = 1.</p>
<hr>
<p><strong>NOTE</strong></p>
<p>It can sometimes be confusing to know which functions come from which
packages (or to know which function <code>R</code> will default to
using). For this reason, it’s good practice to get in the habit of using
the <code>package::function()</code> syntax, as we did for
<code>mutate()</code> above. Using this syntax makes explicit which
package/function you intend to use which makes your code easier for
other to understand and reduces the potential for errors. As a benefit,
you can stop using <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(package)</a></code> at the beginning of
each script.</p>
<hr>
<p>Finally, we need to set the parameter values for the regression
models. This is where understanding what each parameter represents is
very helpful. For example,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is the expected number of seeds when the covariate has a value of 0
(because we centered visits, we interpret
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
to be the expected number of seeds at the mean number of visits):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">250</span> <span class="co"># Expected number of seeds at mean number of visits</span></span></code></pre></div>
<p>Now we set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
coefficient. We have already said the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is positive (seed count increases with visits). All that’s left is to
decide a specific value. Remember that we interpret
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
as the additional number of seeds for 1 sd increase in the number of
visits.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">50</span>   <span class="co"># Effect of visits on seed count</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-generate-expected-counts">Step 2: Generate expected counts<a class="anchor" aria-label="anchor" href="#step-2-generate-expected-counts"></a>
</h2>
<p>To generate the simulated seed counts for each flower, we first have
to calculate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>,
the <em>expected</em> seeds for each flower. We get these values by
simply plugging in the observed visitation values for each site to our
linear model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mn>3</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>μ</mi><mi>N</mi></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>v</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>v</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>v</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mn>3</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>.</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>v</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mi>N</mi></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>×</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>α</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>β</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
    \mu_1 \\
    \mu_2 \\
    \mu_3 \\
    .\\
    .\\
    .\\
    \mu_N
\end{bmatrix} = \begin{bmatrix}
    1  &amp; visits_1\\
    1  &amp; visits_2\\
    1  &amp; visits_3\\
    . &amp; .\\
    . &amp; .\\
    . &amp; .\\
    1  &amp; visits_N
\end{bmatrix} \times
\begin{bmatrix}
    \alpha\\
    \beta 
\end{bmatrix}</annotation></semantics></math></p>
<p>If you remember matrix algebra, multiplying the covariate matrix by
the coefficient matrix is the same as doing:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>×</mo><mi>α</mi><mo>+</mo><mi>v</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mi>i</mi></msub><mo>×</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">1 \times \alpha + visits_i \times \beta</annotation></semantics></math></p>
<p>The matrix of predicted responses is called the <em>linear
predictor</em>.</p>
<p>Now that we have a refreshed our memory of the basic linear model
structure, let’s add the predicted seed counts to the data frame:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sim_df</span>, mu <span class="op">=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="va">beta</span><span class="op">*</span><span class="va">visits.c</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="step-2b-plot-relationships">Step 2b: Plot relationships<a class="anchor" aria-label="anchor" href="#step-2b-plot-relationships"></a>
</h3>
<p>Whenever you simulate data, it’s very useful to plot your data early
and often. It is often difficult to know ahead of time exactly what
response values a complex model will produce. Plots are a great way to
quickly assess whether the simulation is producing values that are
consistent with your domain expertise.</p>
<div class="section level4">
<h4 id="brief-intro-to-ggplot2">Brief intro to <code>ggplot2</code><a class="anchor" aria-label="anchor" href="#brief-intro-to-ggplot2"></a>
</h4>
<p>To be consistent with our use of the <code>tidyverse</code>, we will
create plots using <code>ggplot2()</code>.</p>
<p>The power and flexibility of <code>ggplot2</code> come from it’s
consistent structure. Although a bit overwhelming at first, once you get
the hang of it the structure actually makes it quite easy to create
highly customized publication-quality graphics. All plots created using
<code>ggplot2</code> use the same underlying structure:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><munder><mrow><mi>g</mi><mi>g</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>t</mi></mrow><mo accent="true">⏟</mo></munder><mrow><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>t</mi><mi>e</mi><mspace width="0.278em"></mspace><mi>p</mi><mi>l</mi><mi>o</mi><mi>t</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">(</mo><munder><munder><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mo>=</mo><mi>d</mi><mi>f</mi></mrow><mo accent="true">⏟</mo></munder><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi><mspace width="0.278em"></mspace><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></munder><mo>,</mo><mspace width="0.278em"></mspace><munder><munder><mrow><mi>a</mi><mi>e</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>=</mo><mspace width="0.278em"></mspace><mo>,</mo><mi>y</mi><mo>=</mo><mspace width="0.278em"></mspace><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo accent="true">⏟</mo></munder><mrow><mi>p</mi><mi>l</mi><mi>o</mi><mi>t</mi><mspace width="0.278em"></mspace><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>s</mi></mrow></munder><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><munder><munder><mrow><mi>g</mi><mi>e</mi><mi>o</mi><mi>m</mi><mi>_</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mo accent="true">⏟</mo></munder><mrow><mi>g</mi><mi>e</mi><mi>o</mi><mi>m</mi><mi>e</mi><mi>t</mi><mi>r</mi><mi>y</mi></mrow></munder></mrow><annotation encoding="application/x-tex">\underbrace{ggplot}_{initiate\; plot}(\underbrace{data = df}_{data\;frame},\; \underbrace{aes(x =\; , y = \;)}_{plot\; attributes}) + \underbrace{geom\_line()}_{geometry}</annotation></semantics></math></p>
<p>The <code>ggplot()</code> function initiates a new plot. In this
function, you tell <code>ggplot2</code> what data frame you will be
using for the plot and you tell it how to map attributes of the data to
the visual properties of the figures. Attributes are mapped inside the
<code>aes()</code> argument. Attributes usually include location
(<code>x-axis</code> and <code>y-axis</code> placement), color, size,
shape, line type, and many others. In general, each attribute will be
mapped to one column of your data frame.</p>
<p>The <code>ggplot()</code> function simply initiates a graph so if you
run just that portion of the code you will get a blank graph. We can see
that by creating a new plot showing the relationship between elevation
(the x-axis of the plot) and predicted abundance (the y-axis):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">visits</span>, y <span class="op">=</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab2_simulation_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<p>You can see that <code>ggplot</code> created a figure with the
correct axes and labels. But no data. That’s because we didn’t tell
<code>ggplot</code> what type of <em>geometry</em> to use to represent
the data. Geometry refers to the actual type geometric object(s) we want
to use to display the data. Common geometries include points (e.g.,
scatterplot), lines (e.g., time series), and bars (e.g., histograms).
There are many others. Once we add a geometry, we can see the data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">visits</span>, y <span class="op">=</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab2_simulation_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<p>So we can see that our model predicts seed counts ranging from 171.66
individuals to 337.96. Is that reasonable? Who knows, this is a made up
species. But if it wasn’t, this would be a good time to go back and play
with different parameter values to generate abundances that are
consistent with our domain expertise. For example, the model predicts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>≈</mo><annotation encoding="application/x-tex">\approx</annotation></semantics></math>
171.66 seeds for a flower with 0 pollination visits. Maybe that makes
sense (perhaps the orchids can self-pollinate if necessary) or maybe it
doesn’t. If it doesn’t, we need to re-think the model structure.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="step-3-generate-the-actual-seed-counts">Step 3: Generate the actual seed counts<a class="anchor" aria-label="anchor" href="#step-3-generate-the-actual-seed-counts"></a>
</h2>
<p>So far, our simulated seed counts contain no stochastic variation
(the visitation covariate is stochastic but given that value, the
predicted counts are completely deterministic). To create a realistic
data set, we need to add some process variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>p</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_p</annotation></semantics></math>).
In our example, this requires setting another parameter that controls
the amount of process variation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fl">7.5</span></span></code></pre></div>
<p>Now we simply generate random seed counts using the linear predictor
and the process variation</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Generate actual abundance for each site</span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sim_df</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Plot lambda vs. N</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sim_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_abline</span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab2_simulation_files/figure-html/unnamed-chunk-15-1.png" width="576" style="display: block; margin: auto;"></p>
<p>As expected, seed count increases with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>,
though you can see the process variation that is added to the model at
this stage.</p>
</div>
<div class="section level2">
<h2 id="step-4-save-the-simulated-data">Step 4: Save the simulated data<a class="anchor" aria-label="anchor" href="#step-4-save-the-simulated-data"></a>
</h2>
<p>Now that we have a simulated data set, let’s save it so it’s
available for future use. There are many ways to save objects in
<code>R</code> but one of the most <a href="https://www.fromthebottomoftheheap.net/2012/04/01/saving-and-loading-r-objects/" class="external-link">well-behaved</a>
is <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">sim_df</span>, file <span class="op">=</span> <span class="st">"data/sim_seed_counts.rds"</span><span class="op">)</span></span></code></pre></div>
<p>When you want to use this object in the future, all you have to do is
run<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that with &lt;code&gt;&lt;a href="https://rdrr.io/r/base/readRDS.html" class="external-link"&gt;readRDS()&lt;/a&gt;&lt;/code&gt; you do have to
assign the object you are reading to a new object. If you don’t create a
new object, &lt;code&gt;&lt;a href="https://rdrr.io/r/base/readRDS.html" class="external-link"&gt;readRDS()&lt;/a&gt;&lt;/code&gt; will simply print the data frame.
This has the advantage that you can rename the object something else
when you read it in next time.&lt;/p&gt;'><sup>3</sup></a>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"data/sim_seed_counts.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="homework-questions">Homework Questions<a class="anchor" aria-label="anchor" href="#homework-questions"></a>
</h2>
<p>TBD, but I’m bound to come up with something :)</p>
<ol start="4" style="list-style-type: decimal">
<li>On a 1-10 scale, with 1 being the worst week ever and 10 being the
best, how would you rate this week’s content? What lingering
questions/confusion about the lecture or lab do you still have?</li>
</ol>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
