<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lab8: Resource Selection Functions • WILD8370</title>
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Lab8: Resource Selection Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">WILD8370</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2025.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-house-chimney"></span></a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../articles/syllabus.html"><span class="fa fab fa-readme"></span> Syllabus</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/schedule.html"><span class="fa far fa-calendar"></span> Schedule</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lectures" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-file-powerpoint"></span> Lectures</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lectures">
<li><a class="dropdown-item" href="../articles/lectures/00_course_intro/00_course_intro.html">Lecture 0: Course introduction</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/01_inference/01_inference.html">Lecture 1: Statistical inference in ecology</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/02_probability/02_probability.html">Lecture 2: Probability refresher</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/03_bayes/03_bayes.html">Lecture 3: Principles of Bayesian inference</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/04_intro_nimble/Intro_Nimble.html">Lecture 4: Introduction to Nimble</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/05_glms/05_glms.html">Lecture 5: Generalized linear model review</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/06_priors/06_priors.html">Lecture 6: More about priors</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/07_random_effects/07_random_effects.html">Lecture 7: Random vs. Fixed Effects</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/08_occupancy/08_occupancy.html">Lecture 8: State Space Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/09_NMix/09_NMix.html">Lecture 9: N-Mixture and Occupancy</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/11_DynamicNMix/11_DynamicNMix.html">Lecture 11: Dynamic N-Mixture Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/9b_ExtraOcc/9b_ExtraOcc.html">Lecture 9b: Static Occupancy Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/10_DynamicOcc/10_DynamicOcc.html">Lecture 10: Dynamic Occupancy Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/12_MovementModels/12_MovementModels.html">Lecture 12: Movement Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/13_ClosedCMR/Lecture13_ClosedCMR.html">Lecture 13: Closed CMR</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/14_ClosedSCR/Lecture14_ClosedSCR.html">Lecture 14: Closed SCR</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/15_KnownFate/15_KnownFate.html">Lecture 15: Known Fate Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/16_CJS/16_CJS.html">Lecture 16: CJS Models</a></li>
    <li><a class="dropdown-item" href="../articles/lectures/17_Multistate/17_Multistate.html">Lecture 17: Multistate Models</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-labs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-laptop-code"></span> Labs</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-labs">
<li><a class="dropdown-item" href="../articles/lab01_intro_to_R.html">Lab 0: Introduction to R</a></li>
    <li><a class="dropdown-item" href="../articles/Lab01b_Mathematical_Notation.html">Lab 1: Mathematical Notation</a></li>
    <li><a class="dropdown-item" href="../articles/Lab2_simulation.html">Lab 2: Data Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/Lab3_BasicMCMC.html">Lab 3: Basic MCMC</a></li>
    <li><a class="dropdown-item" href="../articles/Lab4_glms.html">Lab 4: GLMs</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Lab 5: Priors</a></li>
    <li><a class="dropdown-item" href="../articles/Lab6_MissingData.html">Lab 6: Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/Lab7_GOF.html">Lab 7: Goodness of Fit</a></li>
    <li><a class="dropdown-item" href="../articles/Lab8_Movement.html">Lab 8: Resource Selection Functions</a></li>
    <li><a class="dropdown-item" href="../articles/Lab9_SCR.html">Lab 9: Spatial Capture Recapture</a></li>
    <li><a class="dropdown-item" href="../articles/Lab10_CJS.html">Lab 10: CJS</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-references" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa far fa-bookmark"></span> References</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-references">
<li><a class="dropdown-item" href="../articles/homework.html">Assignment instructions</a></li>
    <li><a class="dropdown-item" href="../articles/projects_and_directories.html">Projects and directories</a></li>
    <li><a class="dropdown-item" href="../articles/RMarkdown.html">R Markdown reference</a></li>
    <li><a class="dropdown-item" href="../articles/graphics.html">Creating publication-quality graphics</a></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Lab8: Resource Selection Functions</h1>
            
      

      <div class="d-none name"><code>Lab8_Movement.Rmd</code></div>
    </div>

    
    
<p>In this activity we’ll learn how to construct a simple resource
selection function in a Bayesian framework.</p>
<hr>
<div class="section level2">
<h2 id="objectives">Objectives<a class="anchor" aria-label="anchor" href="#objectives"></a>
</h2>
<ul>
<li><p>Learn how to convert landscape metrics into partial
derivatives</p></li>
<li><p>Run a simple resource selection function in Nimble</p></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="what-is-a-resource-selection-function">What is a resource selection function?<a class="anchor" aria-label="anchor" href="#what-is-a-resource-selection-function"></a>
</h2>
<p>Resource selection functions (RSFs) are a class of functions that are
used in spatial ecology to assess which habitat characteristics are
important to a population or species.</p>
<p>Most RSF literature thinks about selection at 4 scales:</p>
<ul>
<li><p>First order selection: The entire range of a species</p></li>
<li><p>Second order selection: The home range of an individual or group
of animals</p></li>
<li><p>Third order selection: Resource or habitat usage within an
individual’s or group’s home range</p></li>
<li><p>Fourth order selection: The procurement of specific resources,
such as food, at specific sites</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="habitat-gradients">Habitat Gradients<a class="anchor" aria-label="anchor" href="#habitat-gradients"></a>
</h2>
<p>While we often think of continuous environmental covariates as the
value of that covariate (percent tree cover, proportional early
successional agriculture, distance to road, etc.) at a specific
location, another way to consider the world is to think of the relative
difference between any one location and the locations around it. We can
do this using <em>potential functions</em>. Potential functions provide
a straightforward mathematical framework for movement along
environmental gradients.</p>
<p>Much like a marble rolling along a hilly surface, potential functions
can steer movements towards (or away from) particular habitat features
based on their gradients. The gradient is a vector field of partial
derivatives pointing in the direction of the greatest rate of increase
in the habitat covariate. In simple language, we essentially want the
cosine and sine of the <em>aspect</em> of our surface. This requires
first calculating the aspect (what angle the slope of our landscape is
facing).</p>
<p>Here’s what that might look like in a realistic landscape. Imagine we
are interested in the role that canopy cover plays in habitat selection
for spotted skunks. We go to our favorite data warehouse and acquire a
canopy cover layer. Interestingly, it looks exactly like this simulated
dataset after scaling:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">55</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.025</span> <span class="co">## Resolution</span></span>
<span><span class="va">grid0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">delta</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">-</span><span class="va">delta</span><span class="op">/</span><span class="fl">2</span>, <span class="va">delta</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">grid0</span>, each<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grid0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">grid0</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grid0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">distmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">npixels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">distmat</span><span class="op">)</span></span>
<span><span class="co">## Covariance matrix</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.4</span><span class="op">*</span><span class="va">distmat</span><span class="op">)</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">V</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">npixels</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Canopy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grid0</span><span class="op">)</span>, ncols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">grid0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Canopy</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Canopy</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-2-1.png" width="768" style="display: block; margin: auto;"></p>
<p>First, we want the aspect of this beautiful landscape. We can do this
easily in the terra package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aspect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/terrain.html" class="external-link">terrain</a></span><span class="op">(</span><span class="va">Canopy</span>, <span class="st">"aspect"</span>, neighbors <span class="op">=</span> <span class="fl">8</span>, unit <span class="op">=</span> <span class="st">'radians'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-3-1.png" width="768" style="display: block; margin: auto;"></p>
<p>The resulting graph is weird, but it indicates what direction the
slope of the raster is facing for each pixel. A value of 1.5 (90°)
indicates that movement straight up would take me to higher values. A
value of 3.14 (180°) says going left would take me to higher values. A
value of (0) 0° says “nope, I’m at the highest point in the nearby
area!”</p>
<p>Now we can take these values and get the easting (is the value higher
to the left or right?) and the northing (is the value higher in the up
or down direction?). To take you back to high school math, the cosine of
an angle will tell you the relative x value and the sine will tell you
the y value.</p>
<p>Positive values of cosine(x) tell you to go right, negative till you
to go left. Note that R expects the input to be in radians, not
degrees.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">easting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">easting</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Positive values of sine(x) tell you to go up, negative till you to go
down. Note that R expects the input to be in radians, not degrees.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">northing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">northing</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="why-does-this-matter">Why does this matter?<a class="anchor" aria-label="anchor" href="#why-does-this-matter"></a>
</h2>
<p>One thing that’s difficult about resource selection is that we have
to consider two different things at once - what the animal chose (based
on movement data) and what the animal <em>could</em> have chosen but
didn’t (aka, availability of other habitat). By using partial
derivatives, we can model these at the same time! This is something that
is rarely done in classic RSF functions and it leads to all sorts of
mathematical headaches.</p>
</div>
<div class="section level2">
<h2 id="rsf-models">RSF Models<a class="anchor" aria-label="anchor" href="#rsf-models"></a>
</h2>
<p>Now that we’ve learned how to find the partial derivatives of our
landscape, let’s put them into practice. Recall our model for Brownian
Bridge movement:</p>
<p><span class="math display">\Large \mu_t = \mu_{t-1} + \epsilon_{t}
\sim Normal(0, \sigma^2)</span></p>
<p>We can add in a parameter that predicts our next location based on
the environmental conditions at our current location.</p>
<p><span class="math display">\Large \mu_t = \mu_{t-1} +
\omega*\nabla(\mu_{t-1}) + \epsilon_{t} \sim Normal(0, \sigma^2)</span>
Where <span class="math inline">\omega</span> is the strength of the
response to the habitat gradient and <span class="math inline">\nabla(\mu_{t-1})</span> is the habitat gradient at
the previous location (<span class="math inline">\mu_{t-1}</span>). For
x coordinates, <span class="math inline">\nabla(\mu_{t-1})</span> =
cos(aspect) and for y, <span class="math inline">\nabla(\mu_{t-1})</span> = sin(aspect).</p>
<p>Let’s go back to our example of the collared deer from lab and see
how deer movement responds to elevation. Due to some rds irregularities,
our raster is currently saved as a matrix for the time being.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'Arkansas_dem'</span><span class="op">)</span></span>
<span><span class="va">dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">Arkansas_dem</span>, type <span class="op">=</span> <span class="st">'xyz'</span>, crs <span class="op">=</span> <span class="st">'EPSG:26915'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dem</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Let’s grab the aspect, easting and northing of this raster:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aspect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/terrain.html" class="external-link">terrain</a></span><span class="op">(</span><span class="va">dem</span>, <span class="st">"aspect"</span>, neighbors <span class="op">=</span> <span class="fl">8</span>, unit <span class="op">=</span> <span class="st">'radians'</span><span class="op">)</span></span>
<span><span class="va">easting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">)</span></span>
<span><span class="va">northing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">aspect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">easting</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">northing</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;">
Let’s get our nimble model written up:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd_walk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleCode.html" class="external-link">nimbleCode</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nind</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">xmin</span>, <span class="va">xmax</span><span class="op">)</span></span>
<span>    <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">ymin</span>, <span class="va">ymax</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nTelemetry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span>,<span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">omega</span><span class="op">*</span><span class="va">easting</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>      <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span>,<span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">omega</span><span class="op">*</span><span class="va">northing</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, sd<span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">sigma</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">omega</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Side note: If we had to name this model for a manuscript, we could
call it an approximate Langevin diffusion movement model. But
anyway.</p>
<p>Let’s clean up our data. We will also need to know the
easting/northing value for each location we have in our dataset.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">collars</span><span class="op">)</span></span>
<span><span class="va">collars</span><span class="op">$</span><span class="va">Collar.ID_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">collars</span><span class="op">$</span><span class="va">Collar.ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">collars</span><span class="op">$</span><span class="va">Collar.ID_f</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">collars</span><span class="op">$</span><span class="va">easting</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">easting</span>, <span class="va">collars</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">collars</span><span class="op">$</span><span class="va">northing</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">northing</span>, <span class="va">collars</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x'</span>,<span class="st">'y'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nTelemetry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">collars</span><span class="op">$</span><span class="va">Collar.ID_f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nind</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nTelemetry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="va">north</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nind</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nTelemetry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nind</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">me</span> <span class="op">&lt;-</span> <span class="va">collars</span><span class="op">[</span><span class="va">collars</span><span class="op">$</span><span class="va">Collar.ID_f</span> <span class="op">==</span> <span class="va">i</span>,<span class="op">]</span></span>
<span>  <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nTelemetry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">me</span><span class="op">$</span><span class="va">x</span><span class="op">/</span><span class="fl">1e6</span></span>
<span>  <span class="va">s</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nTelemetry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">me</span><span class="op">$</span><span class="va">y</span><span class="op">/</span><span class="fl">1e6</span></span>
<span>  <span class="va">east</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nTelemetry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">me</span><span class="op">$</span><span class="va">easting</span><span class="op">$</span><span class="va">aspect</span></span>
<span>  <span class="va">north</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">:</span><span class="va">nTelemetry</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">me</span><span class="op">$</span><span class="va">northing</span><span class="op">$</span><span class="va">aspect</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> <span class="co">#add some space around locations</span></span>
<span><span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>,<span class="fl">1</span>,<span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span> <span class="co">#add some space around locations</span></span>
<span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> <span class="co">#add some space around locations</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">s</span><span class="op">[</span>,<span class="fl">2</span>,<span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span> <span class="co">#add some space around locations</span></span></code></pre></div>
<p>Time to setup for nimble:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">consts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">xmax</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span>, nind <span class="op">=</span> <span class="va">nind</span>, nTelemetry <span class="op">=</span> <span class="va">nTelemetry</span>, northing <span class="op">=</span> <span class="va">north</span>, easting <span class="op">=</span> <span class="va">east</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>s <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span>
<span><span class="va">inits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sigma'</span>, <span class="st">'omega'</span><span class="op">)</span></span></code></pre></div>
<p>And run!</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsf_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleMCMC.html" class="external-link">nimbleMCMC</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">pd_walk</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                     constants <span class="op">=</span> <span class="va">consts</span>,</span>
<span>                     inits <span class="op">=</span> <span class="fu">inits</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     monitors <span class="op">=</span> <span class="va">params</span>,</span>
<span>                     thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     niter <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                     nburnin <span class="op">=</span> <span class="fl">2500</span>,</span>
<span>                     nchains <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                     samplesAsCodaMCMC <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                      <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MCMCvis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCvis/man/MCMCtrace.html" class="external-link">MCMCtrace</a></span><span class="op">(</span><span class="va">rsf_out</span>, pdf <span class="op">=</span> <span class="cn">F</span>, Rhat <span class="op">=</span> <span class="cn">T</span>, n.eff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="Lab8_Movement_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MCMCvis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MCMCvis/man/MCMCsummary.html" class="external-link">MCMCsummary</a></span><span class="op">(</span><span class="va">rsf_out</span>, Rhat <span class="op">=</span> <span class="cn">F</span>, n.eff<span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">*</span><span class="fl">1e6</span></span>
<span><span class="co">#&gt;          mean    sd    2.5%     50%   97.5%</span></span>
<span><span class="co">#&gt; omega  -3.461 2.633  -8.704  -3.519   1.692</span></span>
<span><span class="co">#&gt; sigma 247.796 1.333 245.309 247.811 250.368</span></span></code></pre></div>
<p>There appears to be a slight negative effect of elevation on deer
movements. In other words, deer are more likely to move towards areas
with lower elevation or to stay at about the same elevation range as
their previous location.</p>
</div>
<div class="section level2">
<h2 id="homework">Homework<a class="anchor" aria-label="anchor" href="#homework"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p>In the WILD8370 package, you’ll find a dataset called
<code>coyote_moves</code>. This object contains a named list. The first
list is some data collected by Dr. Chamberlain et al from collared
coyotes. The second is the matrix version of a raster containing
information about the distance to roads (in meters). The EPSG code for
this raster is 4326. Use this data to fit an RSF like we did above to
this new dataset. Several steps will be required:</p>
<ul>
<li>Make sure the points are in order by date for each individual</li>
<li>Convert Latitude and Longitude to UTMs (EPSG 4326 aka UTM 17N)</li>
<li>Find the easting and northing values for each collar location based
on the aspect of the roads tif</li>
</ul>
</li>
<li><p>Using the deer collar data, fit a correlated random walk (see
slide 16 from lecture for a refresher). Report your estimates for <span class="math inline">\gamma</span> and <span class="math inline">\sigma</span>.</p></li>
<li><p>On a 1-10 scale, with 1 being the worst week ever and 10 being
the best, how would you rate this week’s content? What lingering
questions/confusion about the lecture or lab do you still have?</p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Clark Rushing, Heather Gaya.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
